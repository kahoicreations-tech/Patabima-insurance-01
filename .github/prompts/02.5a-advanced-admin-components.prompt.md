---
mode: agent
title: "Advanced Admin Components & Dashboard Creation"
phase: "Backend Phase 2.5a"
priority: "high"
dependencies: ["02.5-admin-setup"]
---

# Task: Create Advanced Admin Components & Dashboard System

## Objective

Build comprehensive admin dashboard components, analytics tools, and management interfaces that complement the basic admin setup from Phase 2.5. This includes creating custom admin views, dashboard widgets, reporting tools, and administrative workflows for the PataBima insurance system.

## Current Project Analysis

### Existing Architecture

**Backend (insurance-app)**:

- Django REST framework with custom User model (`app.User`)
- Motor insurance models: `MotorCategory`, `MotorSubcategory`, `MotorPricing`, `CommercialTonnagePricing`, `PSVPLLPrice`
- Extendible models: `ExtendiblePricing`, `PolicyExtension`, `ExtensionReminder`
- Business models: `InsuranceQuotation`, `MotorInsuranceDetails`, `DocumentUpload`, `ServiceProcessingLog`
- User profiles: `StaffUserProfile` (agents), `PublicUserProfile` (customers)
- Existing API endpoints: `auth`, `user`, `insurance`, `config`, `integrations`, `documents`, `payments`, `policies`, `notifications`

**Frontend (React Native)**:

- Basic admin screens: `AdminPricingScreen`, `AdminPricingScreenAWS`
- Service layer: `AdminPricingService`, `DjangoAPIService`
- Existing contexts: `AuthContext`, `AWSContext`
- Navigation structure with tab-based system

**Data Flow**:

- PostgreSQL database with proper migrations
- Motor pricing engine service for calculations
- DMVIC integration for vehicle verification
- Document upload and processing capabilities

## Required Admin Components to Create

### 0. Campaign Management System

#### Backend: Campaign Models (`app/models.py` - Additional Models)

```python
class Campaign(BaseModel):
    """Campaign model for marketing and promotional activities"""

    CAMPAIGN_STATUS_CHOICES = [
        ('DRAFT', 'Draft'),
        ('SCHEDULED', 'Scheduled'),
        ('ACTIVE', 'Active'),
        ('PAUSED', 'Paused'),
        ('COMPLETED', 'Completed'),
        ('CANCELLED', 'Cancelled'),
    ]

    CAMPAIGN_TYPE_CHOICES = [
        ('PROMOTIONAL', 'Promotional'),
        ('EDUCATIONAL', 'Educational'),
        ('SEASONAL', 'Seasonal'),
        ('PRODUCT_LAUNCH', 'Product Launch'),
        ('RETENTION', 'Customer Retention'),
        ('ACQUISITION', 'Customer Acquisition'),
    ]

    TARGET_ROLE_CHOICES = [
        ('ALL', 'All Users'),
        ('AGENT', 'Agents Only'),
        ('CUSTOMER', 'Customers Only'),
        ('NEW_USERS', 'New Users'),
        ('ACTIVE_AGENTS', 'Active Agents'),
        ('INACTIVE_AGENTS', 'Inactive Agents'),
    ]

    # Basic Campaign Information
    name = models.CharField(max_length=200, help_text="Campaign name")
    description = models.TextField(help_text="Campaign description")
    campaign_type = models.CharField(max_length=20, choices=CAMPAIGN_TYPE_CHOICES)
    status = models.CharField(max_length=20, choices=CAMPAIGN_STATUS_CHOICES, default='DRAFT')

    # Targeting
    target_roles = models.CharField(max_length=20, choices=TARGET_ROLE_CHOICES, default='ALL')
    target_regions = models.JSONField(default=list, blank=True, help_text="List of target regions")
    target_age_min = models.IntegerField(null=True, blank=True)
    target_age_max = models.IntegerField(null=True, blank=True)

    # Content
    title = models.CharField(max_length=150, help_text="Campaign title shown to users")
    message = models.TextField(help_text="Campaign message content")
    image_url = models.URLField(blank=True, help_text="Campaign image URL")
    call_to_action = models.CharField(max_length=100, help_text="CTA button text")
    action_url = models.URLField(blank=True, help_text="URL when CTA is clicked")

    # Scheduling
    start_date = models.DateTimeField(help_text="Campaign start date and time")
    end_date = models.DateTimeField(help_text="Campaign end date and time")

    # Budget and Goals
    budget = models.DecimalField(max_digits=12, decimal_places=2, null=True, blank=True)
    target_impressions = models.IntegerField(null=True, blank=True)
    target_clicks = models.IntegerField(null=True, blank=True)
    target_conversions = models.IntegerField(null=True, blank=True)

    # Performance Tracking
    total_impressions = models.IntegerField(default=0)
    total_clicks = models.IntegerField(default=0)
    total_conversions = models.IntegerField(default=0)
    total_spent = models.DecimalField(max_digits=12, decimal_places=2, default=0)

    # Admin fields
    created_by = models.ForeignKey(User, on_delete=models.PROTECT, related_name='created_campaigns')
    is_active = models.BooleanField(default=True)

    class Meta:
        ordering = ['-start_date']
        verbose_name = 'Campaign'
        verbose_name_plural = 'Campaigns'

    def __str__(self):
        return f"{self.name} ({self.get_status_display()})"

    @property
    def click_rate(self):
        """Calculate click-through rate"""
        if self.total_impressions > 0:
            return (self.total_clicks / self.total_impressions) * 100
        return 0

    @property
    def conversion_rate(self):
        """Calculate conversion rate"""
        if self.total_clicks > 0:
            return (self.total_conversions / self.total_clicks) * 100
        return 0

    @property
    def cost_per_click(self):
        """Calculate cost per click"""
        if self.total_clicks > 0:
            return self.total_spent / self.total_clicks
        return 0

    @property
    def cost_per_conversion(self):
        """Calculate cost per conversion"""
        if self.total_conversions > 0:
            return self.total_spent / self.total_conversions
        return 0

    @property
    def is_running(self):
        """Check if campaign is currently running"""
        now = timezone.now()
        return (self.status == 'ACTIVE' and
                self.start_date <= now <= self.end_date)

    def get_target_audience_count(self):
        """Get count of users matching campaign targeting criteria"""
        queryset = User.objects.all()

        if self.target_roles != 'ALL':
            if self.target_roles == 'NEW_USERS':
                # Users created in last 30 days
                thirty_days_ago = timezone.now() - timedelta(days=30)
                queryset = queryset.filter(date_created__gte=thirty_days_ago)
            elif self.target_roles == 'ACTIVE_AGENTS':
                # Agents with quotations in last 30 days
                thirty_days_ago = timezone.now() - timedelta(days=30)
                queryset = queryset.filter(
                    role='AGENT',
                    quotations__date_created__gte=thirty_days_ago
                ).distinct()
            elif self.target_roles == 'INACTIVE_AGENTS':
                # Agents without quotations in last 90 days
                ninety_days_ago = timezone.now() - timedelta(days=90)
                queryset = queryset.filter(
                    role='AGENT'
                ).exclude(
                    quotations__date_created__gte=ninety_days_ago
                )
            else:
                queryset = queryset.filter(role=self.target_roles)

        return queryset.count()

class CampaignInteraction(BaseModel):
    """Track user interactions with campaigns"""

    INTERACTION_TYPE_CHOICES = [
        ('IMPRESSION', 'Impression'),
        ('CLICK', 'Click'),
        ('CONVERSION', 'Conversion'),
        ('DISMISS', 'Dismiss'),
    ]

    campaign = models.ForeignKey(Campaign, on_delete=models.CASCADE, related_name='interactions')
    user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='campaign_interactions')
    interaction_type = models.CharField(max_length=20, choices=INTERACTION_TYPE_CHOICES)

    # Metadata
    ip_address = models.GenericIPAddressField(null=True, blank=True)
    user_agent = models.TextField(blank=True)
    referrer = models.URLField(blank=True)

    class Meta:
        ordering = ['-date_created']
        unique_together = ['campaign', 'user', 'interaction_type', 'date_created']

    def __str__(self):
        return f"{self.user.phonenumber} - {self.campaign.name} - {self.interaction_type}"

class CampaignSchedule(BaseModel):
    """Advanced scheduling for campaigns"""

    FREQUENCY_CHOICES = [
        ('ONCE', 'Once'),
        ('DAILY', 'Daily'),
        ('WEEKLY', 'Weekly'),
        ('MONTHLY', 'Monthly'),
    ]

    campaign = models.ForeignKey(Campaign, on_delete=models.CASCADE, related_name='schedules')
    frequency = models.CharField(max_length=20, choices=FREQUENCY_CHOICES, default='ONCE')
    days_of_week = models.JSONField(default=list, blank=True, help_text="For weekly frequency")
    day_of_month = models.IntegerField(null=True, blank=True, help_text="For monthly frequency")
    time_of_day = models.TimeField(help_text="Time to send campaign")
    timezone = models.CharField(max_length=50, default='Africa/Nairobi')

    is_active = models.BooleanField(default=True)
    last_sent = models.DateTimeField(null=True, blank=True)
    next_send = models.DateTimeField(null=True, blank=True)

    class Meta:
        ordering = ['next_send']

    def __str__(self):
        return f"{self.campaign.name} - {self.get_frequency_display()}"
```

#### Backend: Campaign Admin Interface (`app/campaign_admin.py`)

```python
from django.contrib import admin
from django.utils.html import format_html
from django.urls import reverse, path
from django.shortcuts import render, get_object_or_404, redirect
from django.http import JsonResponse
from django.contrib import messages
from django.utils import timezone
from django.db.models import Count, Sum, Avg, Q
from .models import Campaign, CampaignInteraction, CampaignSchedule

@admin.register(Campaign)
class CampaignAdmin(admin.ModelAdmin):
    list_display = ('name', 'campaign_type', 'status_display', 'target_roles',
                   'start_date', 'end_date', 'performance_summary', 'created_by')
    list_filter = ('status', 'campaign_type', 'target_roles', 'start_date', 'created_by')
    search_fields = ('name', 'title', 'description')
    date_hierarchy = 'start_date'
    ordering = ['-start_date']

    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'description', 'campaign_type', 'status')
        }),
        ('Targeting', {
            'fields': ('target_roles', 'target_regions', 'target_age_min', 'target_age_max'),
            'classes': ('collapse',)
        }),
        ('Content', {
            'fields': ('title', 'message', 'image_url', 'call_to_action', 'action_url')
        }),
        ('Scheduling', {
            'fields': ('start_date', 'end_date')
        }),
        ('Budget & Goals', {
            'fields': ('budget', 'target_impressions', 'target_clicks', 'target_conversions'),
            'classes': ('collapse',)
        }),
        ('Performance Tracking', {
            'fields': ('total_impressions', 'total_clicks', 'total_conversions', 'total_spent'),
            'classes': ('collapse',),
            'description': 'These fields are automatically updated based on campaign interactions.'
        }),
    )

    readonly_fields = ('total_impressions', 'total_clicks', 'total_conversions', 'total_spent')

    actions = ['activate_campaigns', 'pause_campaigns', 'clone_campaigns', 'export_performance']

    def status_display(self, obj):
        colors = {
            'DRAFT': '#6c757d',
            'SCHEDULED': '#007bff',
            'ACTIVE': '#28a745',
            'PAUSED': '#ffc107',
            'COMPLETED': '#17a2b8',
            'CANCELLED': '#dc3545',
        }
        color = colors.get(obj.status, '#6c757d')
        status_text = obj.get_status_display()

        if obj.is_running:
            status_text += ' üü¢'

        return format_html(
            '<span style="color: {}; font-weight: bold;">{}</span>',
            color, status_text
        )
    status_display.short_description = 'Status'

    def performance_summary(self, obj):
        if obj.total_impressions > 0:
            ctr = (obj.total_clicks / obj.total_impressions) * 100
            cvr = (obj.total_conversions / obj.total_clicks * 100) if obj.total_clicks > 0 else 0

            return format_html(
                '<div style="font-size: 11px;">'
                '<div>üëÅ {} impressions</div>'
                '<div>üñ± {} clicks (CTR: {:.1f}%)</div>'
                '<div>üéØ {} conversions (CVR: {:.1f}%)</div>'
                '</div>',
                obj.total_impressions, obj.total_clicks, ctr, obj.total_conversions, cvr
            )
        return format_html('<span style="color: #999;">No data yet</span>')
    performance_summary.short_description = 'Performance'

    def get_urls(self):
        urls = super().get_urls()
        custom_urls = [
            path('<int:campaign_id>/preview/', self.admin_site.admin_view(self.preview_campaign),
                 name='campaign_preview'),
            path('<int:campaign_id>/analytics/', self.admin_site.admin_view(self.campaign_analytics),
                 name='campaign_analytics'),
            path('performance-dashboard/', self.admin_site.admin_view(self.performance_dashboard),
                 name='campaign_performance_dashboard'),
        ]
        return custom_urls + urls

    def preview_campaign(self, request, campaign_id):
        """Preview how campaign will look to users"""
        campaign = get_object_or_404(Campaign, id=campaign_id)

        context = {
            'campaign': campaign,
            'target_audience_count': campaign.get_target_audience_count(),
        }

        return render(request, 'admin/campaign/preview.html', context)

    def campaign_analytics(self, request, campaign_id):
        """Detailed analytics for a specific campaign"""
        campaign = get_object_or_404(Campaign, id=campaign_id)

        # Interaction analytics
        interactions_by_type = CampaignInteraction.objects.filter(campaign=campaign)\
            .values('interaction_type')\
            .annotate(count=Count('id'))\
            .order_by('-count')

        # Daily performance
        daily_performance = CampaignInteraction.objects.filter(campaign=campaign)\
            .extra(select={'day': 'date(date_created)'})\
            .values('day')\
            .annotate(
                impressions=Count('id', filter=Q(interaction_type='IMPRESSION')),
                clicks=Count('id', filter=Q(interaction_type='CLICK')),
                conversions=Count('id', filter=Q(interaction_type='CONVERSION'))
            )\
            .order_by('day')

        # Top performing user segments
        user_segments = CampaignInteraction.objects.filter(campaign=campaign)\
            .values('user__role')\
            .annotate(
                total_interactions=Count('id'),
                unique_users=Count('user', distinct=True)
            )\
            .order_by('-total_interactions')

        context = {
            'campaign': campaign,
            'interactions_by_type': interactions_by_type,
            'daily_performance': list(daily_performance),
            'user_segments': user_segments,
        }

        return render(request, 'admin/campaign/analytics.html', context)

    def performance_dashboard(self, request):
        """Overall campaign performance dashboard"""
        # Active campaigns
        active_campaigns = Campaign.objects.filter(status='ACTIVE').count()
        scheduled_campaigns = Campaign.objects.filter(status='SCHEDULED').count()

        # Overall performance
        total_impressions = Campaign.objects.aggregate(total=Sum('total_impressions'))['total'] or 0
        total_clicks = Campaign.objects.aggregate(total=Sum('total_clicks'))['total'] or 0
        total_conversions = Campaign.objects.aggregate(total=Sum('total_conversions'))['total'] or 0
        total_spent = Campaign.objects.aggregate(total=Sum('total_spent'))['total'] or 0

        # Top performing campaigns
        top_campaigns = Campaign.objects.filter(total_impressions__gt=0)\
            .extra(select={'ctr': 'total_clicks * 100.0 / total_impressions'})\
            .order_by('-ctr')[:10]

        # Recent interactions
        recent_interactions = CampaignInteraction.objects.select_related('campaign', 'user')\
            .order_by('-date_created')[:20]

        context = {
            'active_campaigns': active_campaigns,
            'scheduled_campaigns': scheduled_campaigns,
            'total_impressions': total_impressions,
            'total_clicks': total_clicks,
            'total_conversions': total_conversions,
            'total_spent': total_spent,
            'overall_ctr': (total_clicks / total_impressions * 100) if total_impressions > 0 else 0,
            'overall_cvr': (total_conversions / total_clicks * 100) if total_clicks > 0 else 0,
            'top_campaigns': top_campaigns,
            'recent_interactions': recent_interactions,
        }

        return render(request, 'admin/campaign/dashboard.html', context)

    def activate_campaigns(self, request, queryset):
        """Bulk activate campaigns"""
        updated = queryset.filter(status__in=['DRAFT', 'PAUSED']).update(status='ACTIVE')
        self.message_user(request, f"Activated {updated} campaigns")
    activate_campaigns.short_description = "Activate selected campaigns"

    def pause_campaigns(self, request, queryset):
        """Bulk pause campaigns"""
        updated = queryset.filter(status='ACTIVE').update(status='PAUSED')
        self.message_user(request, f"Paused {updated} campaigns")
    pause_campaigns.short_description = "Pause selected campaigns"

    def clone_campaigns(self, request, queryset):
        """Clone selected campaigns"""
        cloned = 0
        for campaign in queryset:
            new_campaign = Campaign.objects.create(
                name=f"{campaign.name} (Copy)",
                description=campaign.description,
                campaign_type=campaign.campaign_type,
                status='DRAFT',
                target_roles=campaign.target_roles,
                target_regions=campaign.target_regions,
                target_age_min=campaign.target_age_min,
                target_age_max=campaign.target_age_max,
                title=campaign.title,
                message=campaign.message,
                image_url=campaign.image_url,
                call_to_action=campaign.call_to_action,
                action_url=campaign.action_url,
                start_date=campaign.start_date,
                end_date=campaign.end_date,
                budget=campaign.budget,
                target_impressions=campaign.target_impressions,
                target_clicks=campaign.target_clicks,
                target_conversions=campaign.target_conversions,
                created_by=request.user,
            )
            cloned += 1

        self.message_user(request, f"Cloned {cloned} campaigns")
    clone_campaigns.short_description = "Clone selected campaigns"

    def save_model(self, request, obj, form, change):
        if not change:  # Creating new campaign
            obj.created_by = request.user
        super().save_model(request, obj, form, change)

@admin.register(CampaignInteraction)
class CampaignInteractionAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'user_display', 'interaction_type', 'date_created')
    list_filter = ('interaction_type', 'campaign__campaign_type', 'date_created')
    search_fields = ('campaign__name', 'user__phonenumber')
    date_hierarchy = 'date_created'
    ordering = ['-date_created']

    readonly_fields = ('campaign', 'user', 'interaction_type', 'date_created',
                      'ip_address', 'user_agent', 'referrer')

    def user_display(self, obj):
        return f"{obj.user.phonenumber} ({obj.user.role})"
    user_display.short_description = 'User'

    def has_add_permission(self, request):
        # Interactions are created programmatically
        return False

@admin.register(CampaignSchedule)
class CampaignScheduleAdmin(admin.ModelAdmin):
    list_display = ('campaign', 'frequency', 'time_of_day', 'next_send', 'is_active')
    list_filter = ('frequency', 'is_active', 'timezone')
    search_fields = ('campaign__name',)
    ordering = ['next_send']

    fieldsets = (
        ('Schedule Configuration', {
            'fields': ('campaign', 'frequency', 'time_of_day', 'timezone')
        }),
        ('Frequency Details', {
            'fields': ('days_of_week', 'day_of_month'),
            'description': 'Configure specific days for weekly/monthly frequency'
        }),
        ('Status', {
            'fields': ('is_active', 'last_sent', 'next_send')
        }),
    )

    readonly_fields = ('last_sent', 'next_send')
```

### 1. Dashboard Analytics System

#### Backend: Custom Admin Views (`app/admin_views.py`)

```python
from django.shortcuts import render
from django.contrib.admin.views.decorators import staff_member_required
from django.db.models import Count, Sum, Avg, Q
from django.utils import timezone
from datetime import timedelta, datetime
from django.http import JsonResponse
import json

@staff_member_required
def admin_dashboard(request):
    """Main admin dashboard with key metrics"""
    # Get date ranges
    today = timezone.now().date()
    last_30_days = today - timedelta(days=30)
    last_7_days = today - timedelta(days=7)

    # Key metrics
    total_users = User.objects.count()
    total_agents = User.objects.filter(role='AGENT').count()
    total_customers = User.objects.filter(role='CUSTOMER').count()
    new_users_30d = User.objects.filter(date_created__gte=last_30_days).count()

    # Insurance metrics
    total_quotations = InsuranceQuotation.objects.count()
    pending_quotations = InsuranceQuotation.objects.filter(status='PENDING').count()
    approved_quotations = InsuranceQuotation.objects.filter(status='APPROVED').count()
    converted_quotations = InsuranceQuotation.objects.filter(status='CONVERTED').count()

    # Pricing metrics
    total_pricing_rules = MotorPricing.objects.filter(is_active=True).count()
    active_underwriters = InsuranceProvider.objects.filter(is_active=True).count()
    total_categories = MotorCategory.objects.filter(is_active=True).count()
    total_subcategories = MotorSubcategory.objects.filter(is_active=True).count()
    extendible_products = MotorSubcategory.objects.filter(is_extendible=True).count()

    # Extension tracking
    pending_extensions = PolicyExtension.objects.filter(extension_status='pending').count()
    grace_period_policies = PolicyExtension.objects.filter(extension_status='grace_period').count()

    # Campaign metrics
    active_campaigns = Campaign.objects.filter(status='ACTIVE').count()
    scheduled_campaigns = Campaign.objects.filter(status='SCHEDULED').count()
    total_campaign_impressions = Campaign.objects.aggregate(total=Sum('total_impressions'))['total'] or 0
    total_campaign_clicks = Campaign.objects.aggregate(total=Sum('total_clicks'))['total'] or 0

    # Revenue metrics (if available)
    total_premium_amount = InsuranceQuotation.objects.aggregate(
        total=Sum('total_premium')
    )['total'] or 0

    context = {
        'total_users': total_users,
        'total_agents': total_agents,
        'total_customers': total_customers,
        'new_users_30d': new_users_30d,
        'total_quotations': total_quotations,
        'pending_quotations': pending_quotations,
        'approved_quotations': approved_quotations,
        'converted_quotations': converted_quotations,
        'total_pricing_rules': total_pricing_rules,
        'active_underwriters': active_underwriters,
        'total_categories': total_categories,
        'total_subcategories': total_subcategories,
        'extendible_products': extendible_products,
        'pending_extensions': pending_extensions,
        'grace_period_policies': grace_period_policies,
        'active_campaigns': active_campaigns,
        'scheduled_campaigns': scheduled_campaigns,
        'total_campaign_impressions': total_campaign_impressions,
        'total_campaign_clicks': total_campaign_clicks,
        'total_premium_amount': total_premium_amount,
    }

    return render(request, 'admin/dashboard/main_dashboard.html', context)

@staff_member_required
def pricing_analytics(request):
    """Pricing analytics and comparison dashboard"""
    # Pricing distribution by underwriter
    pricing_by_underwriter = MotorPricing.objects.filter(is_active=True)\
        .values('underwriter__name')\
        .annotate(count=Count('id'), avg_premium=Avg('base_premium'))\
        .order_by('-count')

    # Category distribution
    category_distribution = MotorSubcategory.objects\
        .values('category__category_name')\
        .annotate(count=Count('id'), pricing_count=Count('pricing'))\
        .order_by('-count')

    # Recent pricing updates
    recent_updates = MotorPricing.objects.filter(is_active=True)\
        .select_related('underwriter', 'subcategory')\
        .order_by('-date_updated')[:10]

    # Extendible product analytics
    extendible_analytics = {
        'total_extendible': MotorSubcategory.objects.filter(is_extendible=True).count(),
        'extendible_pricing_rules': ExtendiblePricing.objects.filter(is_active=True).count(),
        'pending_extensions': PolicyExtension.objects.filter(extension_status='pending').count(),
        'successful_extensions': PolicyExtension.objects.filter(extension_status='extended').count(),
    }

    context = {
        'pricing_by_underwriter': pricing_by_underwriter,
        'category_distribution': category_distribution,
        'recent_updates': recent_updates,
        'extendible_analytics': extendible_analytics,
    }

    return render(request, 'admin/dashboard/pricing_analytics.html', context)

@staff_member_required
def quotation_analytics(request):
    """Quotation and conversion analytics"""
    # Quotation status distribution
    quotation_status = InsuranceQuotation.objects\
        .values('status')\
        .annotate(count=Count('id'))\
        .order_by('-count')

    # Agent performance
    agent_performance = InsuranceQuotation.objects\
        .filter(agent__role='AGENT')\
        .values('agent__phonenumber', 'agent__staff_user_profile__agent_code')\
        .annotate(
            total_quotations=Count('id'),
            converted=Count('id', filter=Q(status='CONVERTED')),
            total_premium=Sum('total_premium')
        )\
        .order_by('-total_quotations')[:10]

    # Insurance type distribution
    insurance_type_dist = InsuranceQuotation.objects\
        .values('insurance_type')\
        .annotate(count=Count('id'), total_premium=Sum('total_premium'))\
        .order_by('-count')

    context = {
        'quotation_status': quotation_status,
        'agent_performance': agent_performance,
        'insurance_type_dist': insurance_type_dist,
    }

    return render(request, 'admin/dashboard/quotation_analytics.html', context)

@staff_member_required
def system_health(request):
    """System health and monitoring dashboard"""
    # Database health
    db_stats = {
        'total_users': User.objects.count(),
        'total_quotations': InsuranceQuotation.objects.count(),
        'total_documents': DocumentUpload.objects.count(),
        'recent_logins': User.objects.filter(last_login__gte=timezone.now() - timedelta(days=7)).count(),
    }

    # API health (check recent service logs)
    api_health = {
        'total_api_calls': ServiceProcessingLog.objects.count(),
        'successful_calls': ServiceProcessingLog.objects.filter(success=True).count(),
        'failed_calls': ServiceProcessingLog.objects.filter(success=False).count(),
        'recent_errors': ServiceProcessingLog.objects.filter(
            success=False,
            date_created__gte=timezone.now() - timedelta(hours=24)
        ).count(),
    }

    # Document processing health
    doc_health = {
        'total_documents': DocumentUpload.objects.count(),
        'processed_documents': DocumentUpload.objects.filter(processing_status='PROCESSED').count(),
        'failed_documents': DocumentUpload.objects.filter(processing_status='FAILED').count(),
    }

    context = {
        'db_stats': db_stats,
        'api_health': api_health,
        'doc_health': doc_health,
    }

    return render(request, 'admin/dashboard/system_health.html', context)

# API endpoints for dashboard data
@staff_member_required
def dashboard_api(request):
    """API endpoint for dashboard data (for AJAX updates)"""
    data_type = request.GET.get('type', 'overview')

    if data_type == 'overview':
        data = {
            'users': User.objects.count(),
            'quotations': InsuranceQuotation.objects.count(),
            'pending_extensions': PolicyExtension.objects.filter(extension_status='pending').count(),
        }
    elif data_type == 'charts':
        # Chart data for frontend
        data = {
            'quotation_trends': list(InsuranceQuotation.objects
                .extra(select={'day': 'date(date_created)'})
                .values('day')
                .annotate(count=Count('id'))
                .order_by('day')[-30:]),
            'insurance_type_pie': list(InsuranceQuotation.objects
                .values('insurance_type')
                .annotate(count=Count('id'))),
        }

    return JsonResponse(data)
```

#### Frontend: Enhanced Admin Dashboard (`templates/admin/dashboard/`)

**`main_dashboard.html`**:

```html
{% extends "admin/base_site.html" %} {% load static %} {% block title %}PataBima
Dashboard{% endblock %} {% block extrahead %}
<link rel="stylesheet" href="{% static 'admin/css/dashboard.css' %}" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %} {% block content %}
<div class="dashboard-container">
  <h1>PataBima Insurance Administration Dashboard</h1>

  <!-- Key Metrics Cards -->
  <div class="metrics-grid">
    <div class="metric-card users">
      <div class="metric-icon">üë•</div>
      <div class="metric-content">
        <h3>{{ total_users|floatformat:0 }}</h3>
        <p>Total Users</p>
        <small>{{ new_users_30d }} new in 30 days</small>
      </div>
    </div>

    <div class="metric-card quotations">
      <div class="metric-icon">üìã</div>
      <div class="metric-content">
        <h3>{{ total_quotations|floatformat:0 }}</h3>
        <p>Total Quotations</p>
        <small>{{ pending_quotations }} pending</small>
      </div>
    </div>

    <div class="metric-card pricing">
      <div class="metric-icon">üí∞</div>
      <div class="metric-content">
        <h3>{{ total_pricing_rules|floatformat:0 }}</h3>
        <p>Active Pricing Rules</p>
        <small>{{ active_underwriters }} underwriters</small>
      </div>
    </div>

    <div class="metric-card extensions">
      <div class="metric-icon">‚è∞</div>
      <div class="metric-content">
        <h3>{{ pending_extensions|floatformat:0 }}</h3>
        <p>Pending Extensions</p>
        <small>{{ grace_period_policies }} in grace period</small>
      </div>
    </div>

    <div class="metric-card campaigns">
      <div class="metric-icon">üì¢</div>
      <div class="metric-content">
        <h3>{{ active_campaigns|floatformat:0 }}</h3>
        <p>Active Campaigns</p>
        <small>{{ scheduled_campaigns }} scheduled</small>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-section">
    <div class="chart-container">
      <h3>Quotation Trends (Last 30 Days)</h3>
      <canvas id="quotationTrendsChart" width="400" height="200"></canvas>
    </div>

    <div class="chart-container">
      <h3>Insurance Type Distribution</h3>
      <canvas id="insuranceTypePieChart" width="400" height="200"></canvas>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions">
    <h3>Quick Actions</h3>
    <div class="action-buttons">
      <a href="/admin/app/motorpricing/" class="btn btn-primary"
        >Manage Pricing</a
      >
      <a href="/admin/app/extendiblepricing/" class="btn btn-secondary"
        >Extendible Products</a
      >
      <a href="/admin/app/policyextension/" class="btn btn-warning"
        >Policy Extensions</a
      >
      <a href="/admin/app/insurancequotation/" class="btn btn-info"
        >View Quotations</a
      >
      <a href="/admin/app/campaign/" class="btn btn-success"
        >Campaign Management</a
      >
      <a href="/admin/app/campaign/performance-dashboard/" class="btn btn-dark"
        >Campaign Analytics</a
      >
    </div>
  </div>

  <!-- Recent Activity -->
  <div class="recent-activity">
    <h3>Recent Activity</h3>
    <div id="recentActivityFeed">
      <!-- Populated via AJAX -->
    </div>
  </div>
</div>

<script>
  // Chart initialization and data loading
  document.addEventListener("DOMContentLoaded", function () {
    loadDashboardCharts();
    loadRecentActivity();

    // Auto-refresh every 5 minutes
    setInterval(loadDashboardCharts, 300000);
  });

  function loadDashboardCharts() {
    fetch("/admin/dashboard-api/?type=charts")
      .then((response) => response.json())
      .then((data) => {
        updateQuotationTrendsChart(data.quotation_trends);
        updateInsuranceTypePieChart(data.insurance_type_pie);
      });
  }

  function updateQuotationTrendsChart(data) {
    const ctx = document
      .getElementById("quotationTrendsChart")
      .getContext("2d");
    new Chart(ctx, {
      type: "line",
      data: {
        labels: data.map((item) => item.day),
        datasets: [
          {
            label: "Quotations",
            data: data.map((item) => item.count),
            borderColor: "#D5222B",
            backgroundColor: "rgba(213, 34, 43, 0.1)",
            tension: 0.4,
          },
        ],
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
          },
        },
      },
    });
  }

  function updateInsuranceTypePieChart(data) {
    const ctx = document
      .getElementById("insuranceTypePieChart")
      .getContext("2d");
    new Chart(ctx, {
      type: "pie",
      data: {
        labels: data.map((item) => item.insurance_type),
        datasets: [
          {
            data: data.map((item) => item.count),
            backgroundColor: [
              "#D5222B",
              "#646767",
              "#FF6B6B",
              "#4ECDC4",
              "#45B7D1",
              "#96CEB4",
              "#FFEAA7",
              "#DDA0DD",
              "#98D8C8",
              "#F7DC6F",
            ],
          },
        ],
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: "bottom",
          },
        },
      },
    });
  }

  function loadRecentActivity() {
    // Implementation for recent activity feed
    const feed = document.getElementById("recentActivityFeed");
    // Populate with recent admin actions, quotations, etc.
  }
</script>
{% endblock %}
```

### 2. Advanced User Management System

#### Backend: Enhanced User Admin (`app/admin_enhancements.py`)

```python
from django.contrib import admin
from django.contrib.auth.admin import UserAdmin as BaseUserAdmin
from django.utils.html import format_html
from django.urls import reverse
from django.db.models import Count, Q
from .models import User, StaffUserProfile, PublicUserProfile

class StaffUserProfileInline(admin.StackedInline):
    model = StaffUserProfile
    can_delete = False
    verbose_name_plural = 'Staff Profile'
    fields = ('agent_code', 'agent_prefix', 'full_names', 'idnum', 'dob',
              'physical_address', 'gender', 'is_email_verified', 'is_phone_verified')

class PublicUserProfileInline(admin.StackedInline):
    model = PublicUserProfile
    can_delete = False
    verbose_name_plural = 'Customer Profile'
    fields = ('registration_number', 'full_names', 'idnum', 'dob',
              'physical_address', 'gender', 'is_email_verified', 'is_phone_verified')

@admin.register(User)
class EnhancedUserAdmin(BaseUserAdmin):
    list_display = ('phonenumber', 'email', 'role', 'full_name_display',
                   'is_active', 'is_verified_display', 'quotation_count',
                   'last_login', 'date_created')
    list_filter = ('role', 'is_active', 'is_staff', 'date_created',
                   'public_user_profile__is_email_verified',
                   'staff_user_profile__is_email_verified')
    search_fields = ('phonenumber', 'email', 'public_user_profile__full_names',
                    'staff_user_profile__full_names', 'staff_user_profile__agent_code')
    ordering = ('-date_created',)

    fieldsets = (
        ('Basic Information', {
            'fields': ('phonenumber', 'email', 'role', 'is_active')
        }),
        ('System Access', {
            'fields': ('is_staff', 'is_admin', 'is_default_password'),
            'classes': ('collapse',)
        }),
        ('Metadata', {
            'fields': ('date_created', 'date_updated', 'last_login'),
            'classes': ('collapse',)
        }),
    )

    readonly_fields = ('date_created', 'date_updated', 'last_login')

    inlines = []

    def get_inline_instances(self, request, obj=None):
        if obj and obj.role == 'AGENT':
            return [StaffUserProfileInline(self.model, self.admin_site)]
        elif obj and obj.role == 'CUSTOMER':
            return [PublicUserProfileInline(self.model, self.admin_site)]
        return []

    def full_name_display(self, obj):
        if hasattr(obj, 'staff_user_profile'):
            return obj.staff_user_profile.full_names
        elif hasattr(obj, 'public_user_profile'):
            return obj.public_user_profile.full_names
        return 'No Profile'
    full_name_display.short_description = 'Full Name'

    def is_verified_display(self, obj):
        email_verified = False
        phone_verified = False

        if hasattr(obj, 'staff_user_profile'):
            email_verified = obj.staff_user_profile.is_email_verified
            phone_verified = obj.staff_user_profile.is_phone_verified
        elif hasattr(obj, 'public_user_profile'):
            email_verified = obj.public_user_profile.is_email_verified
            phone_verified = obj.public_user_profile.is_phone_verified

        status = []
        if email_verified:
            status.append('üìß')
        if phone_verified:
            status.append('üì±')

        return ' '.join(status) if status else '‚ùå'
    is_verified_display.short_description = 'Verified'

    def quotation_count(self, obj):
        count = obj.quotations.count()
        if count > 0:
            url = reverse('admin:app_insurancequotation_changelist') + f'?agent__id__exact={obj.id}'
            return format_html('<a href="{}">{} quotations</a>', url, count)
        return '0 quotations'
    quotation_count.short_description = 'Quotations'

    def get_queryset(self, request):
        qs = super().get_queryset(request)
        return qs.select_related('staff_user_profile', 'public_user_profile')\
                 .prefetch_related('quotations')

    actions = ['verify_email', 'verify_phone', 'reset_password_flag', 'send_welcome_sms']

    def verify_email(self, request, queryset):
        for user in queryset:
            if hasattr(user, 'staff_user_profile'):
                user.staff_user_profile.is_email_verified = True
                user.staff_user_profile.save()
            elif hasattr(user, 'public_user_profile'):
                user.public_user_profile.is_email_verified = True
                user.public_user_profile.save()
        self.message_user(request, f"Email verified for {queryset.count()} users")
    verify_email.short_description = "Mark email as verified"

    def verify_phone(self, request, queryset):
        for user in queryset:
            if hasattr(user, 'staff_user_profile'):
                user.staff_user_profile.is_phone_verified = True
                user.staff_user_profile.save()
            elif hasattr(user, 'public_user_profile'):
                user.public_user_profile.is_phone_verified = True
                user.public_user_profile.save()
        self.message_user(request, f"Phone verified for {queryset.count()} users")
    verify_phone.short_description = "Mark phone as verified"
```

### 3. Document Management & Processing Admin

#### Backend: Document Processing Admin (`app/document_admin.py`)

```python
from django.contrib import admin
from django.utils.html import format_html
from django.urls import reverse, path
from django.shortcuts import render, get_object_or_404
from django.http import HttpResponse, JsonResponse
from .models import DocumentUpload, ServiceProcessingLog

@admin.register(DocumentUpload)
class DocumentUploadAdmin(admin.ModelAdmin):
    list_display = ('quotation_link', 'document_type', 'original_filename',
                   'processing_status', 'confidence_display', 'upload_date', 'file_size_display')
    list_filter = ('document_type', 'processing_status', 'date_created')
    search_fields = ('quotation__quotation_number', 'original_filename', 'document_type')
    readonly_fields = ('file_size_display', 'upload_date', 'extraction_confidence')

    fieldsets = (
        ('Document Information', {
            'fields': ('quotation', 'document_type', 'original_filename', 'file_path')
        }),
        ('Processing Status', {
            'fields': ('processing_status', 'extraction_confidence', 'extracted_data')
        }),
        ('Metadata', {
            'fields': ('upload_date', 'file_size_display'),
            'classes': ('collapse',)
        }),
    )

    actions = ['reprocess_documents', 'download_documents', 'mark_processed']

    def quotation_link(self, obj):
        if obj.quotation:
            url = reverse('admin:app_insurancequotation_change', args=[obj.quotation.id])
            return format_html('<a href="{}">{}</a>', url, obj.quotation.quotation_number)
        return 'No Quotation'
    quotation_link.short_description = 'Quotation'

    def confidence_display(self, obj):
        if obj.extraction_confidence:
            confidence = obj.extraction_confidence
            color = 'green' if confidence > 0.8 else 'orange' if confidence > 0.6 else 'red'
            return format_html('<span style="color: {};">{:.1%}</span>', color, confidence)
        return 'N/A'
    confidence_display.short_description = 'Confidence'

    def file_size_display(self, obj):
        # Implement file size calculation if needed
        return 'N/A'
    file_size_display.short_description = 'File Size'

    def upload_date(self, obj):
        return obj.date_created
    upload_date.short_description = 'Upload Date'

    def reprocess_documents(self, request, queryset):
        # Trigger reprocessing of selected documents
        processed = 0
        for doc in queryset:
            # Add logic to trigger reprocessing
            doc.processing_status = 'PENDING'
            doc.save()
            processed += 1

        self.message_user(request, f"Reprocessing {processed} documents")
    reprocess_documents.short_description = "Reprocess selected documents"

@admin.register(ServiceProcessingLog)
class ServiceProcessingLogAdmin(admin.ModelAdmin):
    list_display = ('quotation_link', 'service_type', 'success_display',
                   'processing_time_display', 'date_created')
    list_filter = ('service_type', 'success', 'date_created')
    search_fields = ('quotation__quotation_number', 'service_type')
    readonly_fields = ('processing_time_display', 'response_preview')

    fieldsets = (
        ('Request Information', {
            'fields': ('quotation', 'service_type', 'request_data')
        }),
        ('Response Information', {
            'fields': ('success', 'response_data', 'response_preview', 'error_message')
        }),
        ('Performance', {
            'fields': ('processing_time_display', 'date_created'),
            'classes': ('collapse',)
        }),
    )

    def quotation_link(self, obj):
        if obj.quotation:
            url = reverse('admin:app_insurancequotation_change', args=[obj.quotation.id])
            return format_html('<a href="{}">{}</a>', url, obj.quotation.quotation_number)
        return 'No Quotation'
    quotation_link.short_description = 'Quotation'

    def success_display(self, obj):
        if obj.success:
            return format_html('<span style="color: green;">‚úì Success</span>')
        else:
            return format_html('<span style="color: red;">‚úó Failed</span>')
    success_display.short_description = 'Status'

    def processing_time_display(self, obj):
        if obj.processing_time:
            return f"{obj.processing_time}ms"
        return 'N/A'
    processing_time_display.short_description = 'Processing Time'

    def response_preview(self, obj):
        if obj.response_data:
            import json
            preview = json.dumps(obj.response_data, indent=2)[:500]
            return format_html('<pre>{}</pre>', preview)
        return 'No response data'
    response_preview.short_description = 'Response Preview'
```

### 4. Business Intelligence & Reporting

#### Backend: Reporting Views (`app/reporting_views.py`)

```python
from django.shortcuts import render
from django.contrib.admin.views.decorators import staff_member_required
from django.http import HttpResponse, JsonResponse
from django.db.models import Count, Sum, Avg, Q, F
from django.utils import timezone
from datetime import timedelta, datetime
import json
import csv
from io import StringIO

@staff_member_required
def business_intelligence(request):
    """Main BI dashboard"""
    # Agent performance metrics
    agent_metrics = User.objects.filter(role='AGENT')\
        .select_related('staff_user_profile')\
        .annotate(
            total_quotations=Count('quotations'),
            converted_quotations=Count('quotations', filter=Q(quotations__status='CONVERTED')),
            total_premium=Sum('quotations__total_premium'),
            avg_premium=Avg('quotations__total_premium')
        )\
        .order_by('-total_quotations')[:10]

    # Product performance
    product_performance = MotorSubcategory.objects\
        .annotate(
            quotation_count=Count('motorinsurancedetails__quotation'),
            total_premium=Sum('motorinsurancedetails__quotation__total_premium'),
            avg_premium=Avg('motorinsurancedetails__quotation__total_premium')
        )\
        .order_by('-quotation_count')[:15]

    # Underwriter performance
    underwriter_performance = InsuranceProvider.objects.filter(is_active=True)\
        .annotate(
            pricing_rules=Count('motor_pricing'),
            quotations_count=Count('motor_pricing__subcategory__motorinsurancedetails__quotation'),
            avg_premium=Avg('motor_pricing__base_premium')
        )\
        .order_by('-quotations_count')

    # Time-based analytics
    today = timezone.now().date()
    last_30_days = today - timedelta(days=30)

    daily_stats = InsuranceQuotation.objects.filter(date_created__gte=last_30_days)\
        .extra(select={'day': 'date(date_created)'})\
        .values('day')\
        .annotate(
            count=Count('id'),
            total_premium=Sum('total_premium'),
            converted=Count('id', filter=Q(status='CONVERTED'))
        )\
        .order_by('day')

    context = {
        'agent_metrics': agent_metrics,
        'product_performance': product_performance,
        'underwriter_performance': underwriter_performance,
        'daily_stats': list(daily_stats),
    }

    return render(request, 'admin/reports/business_intelligence.html', context)

@staff_member_required
def export_agent_report(request):
    """Export agent performance report as CSV"""
    response = HttpResponse(content_type='text/csv')
    response['Content-Disposition'] = 'attachment; filename="agent_performance_report.csv"'

    writer = csv.writer(response)
    writer.writerow(['Agent Code', 'Full Name', 'Phone', 'Total Quotations',
                    'Converted Quotations', 'Conversion Rate', 'Total Premium', 'Avg Premium'])

    agents = User.objects.filter(role='AGENT')\
        .select_related('staff_user_profile')\
        .annotate(
            total_quotations=Count('quotations'),
            converted_quotations=Count('quotations', filter=Q(quotations__status='CONVERTED')),
            total_premium=Sum('quotations__total_premium'),
            avg_premium=Avg('quotations__total_premium')
        )

    for agent in agents:
        conversion_rate = 0
        if agent.total_quotations > 0:
            conversion_rate = (agent.converted_quotations / agent.total_quotations) * 100

        writer.writerow([
            getattr(agent.staff_user_profile, 'agent_code', 'N/A'),
            getattr(agent.staff_user_profile, 'full_names', 'N/A'),
            agent.phonenumber,
            agent.total_quotations,
            agent.converted_quotations,
            f"{conversion_rate:.1f}%",
            agent.total_premium or 0,
            agent.avg_premium or 0,
        ])

    return response

@staff_member_required
def pricing_comparison_report(request):
    """Generate pricing comparison report across underwriters"""
    # Get pricing comparison data
    subcategories = MotorSubcategory.objects.filter(is_active=True)\
        .prefetch_related('pricing__underwriter')

    comparison_data = []
    for subcategory in subcategories:
        pricing_by_underwriter = {}
        for pricing in subcategory.pricing.filter(is_active=True):
            pricing_by_underwriter[pricing.underwriter.name] = {
                'base_premium': pricing.base_premium,
                'minimum_premium': pricing.minimum_premium,
                'sum_insured_min': pricing.sum_insured_min,
                'sum_insured_max': pricing.sum_insured_max,
            }

        if pricing_by_underwriter:
            comparison_data.append({
                'subcategory': subcategory,
                'pricing': pricing_by_underwriter
            })

    context = {
        'comparison_data': comparison_data,
        'underwriters': InsuranceProvider.objects.filter(is_active=True).values_list('name', flat=True)
    }

    return render(request, 'admin/reports/pricing_comparison.html', context)
```

### 5. Enhanced Django Admin Site Customization

#### Backend: Custom Admin Site Configuration (`app/admin_site.py`)

```python
from django.contrib import admin
from django.contrib.admin import AdminSite
from django.urls import path
from django.template.response import TemplateResponse
from django.utils.translation import gettext_lazy as _

class PataBimaAdminSite(AdminSite):
    """Custom admin site for PataBima Insurance"""

    site_header = 'PataBima Insurance Administration'
    site_title = 'PataBima Admin'
    index_title = 'PataBima Insurance Management Dashboard'

    def get_urls(self):
        """Add custom URLs to admin site"""
        urls = super().get_urls()
        custom_urls = [
            path('dashboard/', self.admin_view(self.dashboard_view), name='dashboard'),
            path('pricing-analytics/', self.admin_view(self.pricing_analytics_view), name='pricing_analytics'),
            path('quotation-analytics/', self.admin_view(self.quotation_analytics_view), name='quotation_analytics'),
            path('system-health/', self.admin_view(self.system_health_view), name='system_health'),
            path('dashboard-api/', self.admin_view(self.dashboard_api), name='dashboard_api'),
            path('export/agent-report/', self.admin_view(self.export_agent_report), name='export_agent_report'),
            path('export/pricing-comparison/', self.admin_view(self.pricing_comparison_report), name='pricing_comparison'),
        ]
        return custom_urls + urls

    def dashboard_view(self, request):
        """Main admin dashboard view"""
        from .admin_views import admin_dashboard
        return admin_dashboard(request)

    def pricing_analytics_view(self, request):
        """Pricing analytics dashboard"""
        from .admin_views import pricing_analytics
        return pricing_analytics(request)

    def quotation_analytics_view(self, request):
        """Quotation analytics dashboard"""
        from .admin_views import quotation_analytics
        return quotation_analytics(request)

    def system_health_view(self, request):
        """System health monitoring"""
        from .admin_views import system_health
        return system_health(request)

    def dashboard_api(self, request):
        """Dashboard API for AJAX updates"""
        from .admin_views import dashboard_api
        return dashboard_api(request)

    def export_agent_report(self, request):
        """Export agent performance report"""
        from .reporting_views import export_agent_report
        return export_agent_report(request)

    def pricing_comparison_report(self, request):
        """Pricing comparison report"""
        from .reporting_views import pricing_comparison_report
        return pricing_comparison_report(request)

    def index(self, request, extra_context=None):
        """Custom admin index with dashboard widgets"""
        extra_context = extra_context or {}

        # Add quick stats to context
        from .models import User, InsuranceQuotation, MotorPricing, PolicyExtension, Campaign
        from django.db.models import Count, Sum

        extra_context.update({
            'total_users': User.objects.count(),
            'total_agents': User.objects.filter(role='AGENT').count(),
            'total_quotations': InsuranceQuotation.objects.count(),
            'pending_quotations': InsuranceQuotation.objects.filter(status='PENDING').count(),
            'active_pricing_rules': MotorPricing.objects.filter(is_active=True).count(),
            'pending_extensions': PolicyExtension.objects.filter(extension_status='pending').count(),
            'active_campaigns': Campaign.objects.filter(status='ACTIVE').count(),
            'scheduled_campaigns': Campaign.objects.filter(status='SCHEDULED').count(),
            'show_dashboard_widgets': True,
        })

        return super().index(request, extra_context)

# Create the custom admin site instance
patabima_admin_site = PataBimaAdminSite(name='patabima_admin')
```

#### Enhanced Admin Templates (`templates/admin/`)

**Custom Admin Base (`base_site.html`)**:

````html
{% extends "admin/base.html" %} {% load static %} {% block title %}{{ title }} |
PataBima Insurance Admin{% endblock %} {% block branding %}
<h1 id="site-name">
  <a href="{% url 'admin:index' %}">
    <img
      src="{% static 'admin/img/patabima-logo.png' %}"
      alt="PataBima"
      height="40"
      style="margin-right: 10px;"
    />
    PataBima Insurance
  </a>
</h1>
{% endblock %} {% block nav-global %}
<div class="navbar">
  <ul>
    <li><a href="{% url 'admin:dashboard' %}">Dashboard</a></li>
    <li><a href="{% url 'admin:pricing_analytics' %}">Pricing Analytics</a></li>
    <li>
      <a href="{% url 'admin:quotation_analytics' %}">Quotation Analytics</a>
    </li>
    <li><a href="{% url 'admin:system_health' %}">System Health</a></li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle">Reports ‚ñº</a>
      <ul class="dropdown-menu">
        <li>
          <a href="{% url 'admin:export_agent_report' %}">Agent Performance</a>
        </li>
        <li>
          <a href="{% url 'admin:pricing_comparison' %}">Pricing Comparison</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
{% endblock %} {% block extrahead %} {{ block.super }}
<link rel="stylesheet" href="{% static 'admin/css/patabima-admin.css' %}" />
<script src="{% static 'admin/js/patabima-admin.js' %}"></script>
{% endblock %} **Enhanced Admin Index (`index.html`)**: ```html {% extends
"admin/base_site.html" %} {% load static %} {% block content %}
<h1>PataBima Insurance Administration</h1>

{% if show_dashboard_widgets %}
<!-- Quick Stats Dashboard -->
<div class="dashboard-widgets">
  <div class="widget-row">
    <div class="dashboard-widget users">
      <div class="widget-icon">üë•</div>
      <div class="widget-content">
        <h3>{{ total_users }}</h3>
        <p>Total Users</p>
        <small>{{ total_agents }} agents</small>
      </div>
    </div>

    <div class="dashboard-widget quotations">
      <div class="widget-icon">üìã</div>
      <div class="widget-content">
        <h3>{{ total_quotations }}</h3>
        <p>Total Quotations</p>
        <small>{{ pending_quotations }} pending</small>
      </div>
    </div>

    <div class="dashboard-widget pricing">
      <div class="widget-icon">üí∞</div>
      <div class="widget-content">
        <h3>{{ active_pricing_rules }}</h3>
        <p>Active Pricing Rules</p>
      </div>
    </div>

    <div class="dashboard-widget extensions">
      <div class="widget-icon">‚è∞</div>
      <div class="widget-content">
        <h3>{{ pending_extensions }}</h3>
        <p>Pending Extensions</p>
      </div>
    </div>

    <div class="dashboard-widget campaigns">
      <div class="widget-icon">üì¢</div>
      <div class="widget-content">
        <h3>{{ active_campaigns }}</h3>
        <p>Active Campaigns</p>
        <small>{{ scheduled_campaigns }} scheduled</small>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="quick-actions">
  <h2>Quick Actions</h2>
  <div class="action-buttons">
    <a href="{% url 'admin:dashboard' %}" class="btn btn-primary">
      <span class="icon">üìä</span>
      Full Dashboard
    </a>
    <a
      href="{% url 'admin:app_motorpricing_changelist' %}"
      class="btn btn-secondary"
    >
      <span class="icon">üí∞</span>
      Manage Pricing
    </a>
    <a
      href="{% url 'admin:app_extendiblepricing_changelist' %}"
      class="btn btn-info"
    >
      <span class="icon">üìÖ</span>
      Extendible Products
    </a>
    <a
      href="{% url 'admin:app_policyextension_changelist' %}"
      class="btn btn-warning"
    >
      <span class="icon">üîÑ</span>
      Policy Extensions
    </a>
    <a href="{% url 'admin:app_campaign_changelist' %}" class="btn btn-success">
      <span class="icon">üì¢</span>
      Campaign Management
    </a>
    <a
      href="{% url 'admin:app_campaign_performance_dashboard' %}"
      class="btn btn-dark"
    >
      <span class="icon">üìä</span>
      Campaign Analytics
    </a>
  </div>
</div>
{% endif %}

<!-- Standard Django Admin Content -->
<div class="admin-content">
  {% for app in available_apps %}
  <div class="app-{{ app.app_label }} module">
    <table>
      <caption>
        <a
          href="{{ app.app_url }}"
          class="section"
          title="{% blocktrans with name=app.name %}Models in the {{ name }} application{% endblocktrans %}"
          >{{ app.name }}</a
        >
      </caption>
      {% for model in app.models %}
      <tr class="model-{{ model.object_name|lower }}">
        {% if model.admin_url %}
        <th scope="row">
          <a href="{{ model.admin_url }}">{{ model.name }}</a>
        </th>
        {% else %}
        <th scope="row">{{ model.name }}</th>
        {% endif %} {% if model.add_url %}
        <td><a href="{{ model.add_url }}" class="addlink">Add</a></td>
        {% else %}
        <td>&nbsp;</td>
        {% endif %} {% if model.admin_url %}
        <td><a href="{{ model.admin_url }}" class="changelink">Change</a></td>
        {% else %}
        <td>&nbsp;</td>
        {% endif %}
      </tr>
      {% endfor %}
    </table>
  </div>
  {% endfor %}
</div>
{% endblock %}
````

#### Admin Styling (`static/admin/css/patabima-admin.css`)

```css
/* PataBima Admin Customization */
:root {
  --patabima-primary: #d5222b;
  --patabima-secondary: #646767;
  --patabima-success: #4caf50;
  --patabima-warning: #ff9800;
  --patabima-info: #2196f3;
}

/* Header Styling */
#site-name a {
  color: var(--patabima-primary) !important;
  text-decoration: none;
  display: flex;
  align-items: center;
}

/* Navigation Bar */
.navbar {
  background: var(--patabima-primary);
  margin: 0;
  padding: 0;
}

.navbar ul {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
}

.navbar li {
  position: relative;
}

.navbar a {
  display: block;
  padding: 12px 20px;
  color: white;
  text-decoration: none;
  transition: background-color 0.3s;
}

.navbar a:hover {
  background-color: rgba(255, 255, 255, 0.1);
}

.dropdown-menu {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background: white;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  z-index: 1000;
  min-width: 200px;
}

.dropdown:hover .dropdown-menu {
  display: block;
}

.dropdown-menu a {
  color: var(--patabima-primary);
  padding: 10px 15px;
  border-bottom: 1px solid #eee;
}

/* Dashboard Widgets */
.dashboard-widgets {
  margin: 20px 0;
}

.widget-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.dashboard-widget {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  border-left: 4px solid var(--patabima-primary);
  display: flex;
  align-items: center;
  transition: transform 0.2s;
}

.dashboard-widget:hover {
  transform: translateY(-2px);
}

.dashboard-widget.users {
  border-left-color: var(--patabima-primary);
}

.dashboard-widget.quotations {
  border-left-color: var(--patabima-success);
}

.dashboard-widget.pricing {
  border-left-color: var(--patabima-warning);
}

.dashboard-widget.extensions {
  border-left-color: var(--patabima-info);
}

.dashboard-widget.campaigns {
  border-left-color: #28a745;
}

.widget-icon {
  font-size: 2.5em;
  margin-right: 15px;
  opacity: 0.8;
}

.widget-content h3 {
  margin: 0;
  font-size: 2em;
  font-weight: bold;
  color: #333;
}

.widget-content p {
  margin: 5px 0 0 0;
  color: #666;
  font-weight: 500;
}

.widget-content small {
  color: #999;
  font-size: 0.85em;
}

/* Quick Actions */
.quick-actions {
  margin: 30px 0;
}

.quick-actions h2 {
  color: var(--patabima-primary);
  border-bottom: 2px solid var(--patabima-primary);
  padding-bottom: 10px;
}

.action-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 15px 20px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 500;
  transition: all 0.3s;
  border: none;
  cursor: pointer;
}

.btn .icon {
  margin-right: 8px;
  font-size: 1.2em;
}

.btn-primary {
  background: var(--patabima-primary);
  color: white;
}

.btn-secondary {
  background: var(--patabima-secondary);
  color: white;
}

.btn-info {
  background: var(--patabima-info);
  color: white;
}

.btn-warning {
  background: var(--patabima-warning);
  color: white;
}

.btn-success {
  background: #28a745;
  color: white;
}

.btn-dark {
  background: #343a40;
  color: white;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Admin Content */
.admin-content {
  margin-top: 40px;
}

/* Responsive Design */
@media (max-width: 768px) {
  .navbar ul {
    flex-direction: column;
  }

  .widget-row {
    grid-template-columns: 1fr;
  }

  .action-buttons {
    grid-template-columns: 1fr;
  }
}
```

```

## Success Criteria

### Phase 1: Dashboard & Analytics
- [ ] **Main admin dashboard** with key metrics and real-time updates
- [ ] **Pricing analytics dashboard** with underwriter comparisons and trends
- [ ] **Quotation analytics** with agent performance and conversion rates
- [ ] **System health monitoring** with API status and error tracking
- [ ] **Campaign performance dashboard** with engagement metrics and ROI analysis
- [ ] **Interactive charts** using Chart.js for data visualization
- [ ] **Auto-refresh functionality** for real-time data updates

### Phase 2: Enhanced User Management
- [ ] **Advanced user admin** with inline profiles and verification status
- [ ] **Agent performance tracking** with quotation counts and conversions
- [ ] **Customer profile management** with verification workflows
- [ ] **Bulk user operations** for verification and password resets
- [ ] **User activity logging** and audit trails

### Phase 3: Document & Service Management
- [ ] **Document processing admin** with reprocessing capabilities
- [ ] **Service log monitoring** with performance metrics
- [ ] **Extraction confidence tracking** and manual review workflows
- [ ] **File management tools** with download and export features

### Phase 4: Business Intelligence
- [ ] **Agent performance reports** with conversion tracking
- [ ] **Product performance analytics** with revenue insights
- [ ] **Underwriter comparison tools** with competitive analysis
- [ ] **Time-based trending** with daily/weekly/monthly views
- [ ] **CSV export functionality** for external analysis

### Phase 5: Enhanced Django Admin Integration
- [ ] **Custom admin site** with PataBima branding and navigation
- [ ] **Dashboard widgets** integrated into Django admin index page
- [ ] **Custom admin templates** with responsive design and PataBima styling
- [ ] **Enhanced admin navigation** with quick access to analytics and reports
- [ ] **Improved admin styling** with PataBima brand colors and modern UI

### Phase 6: Campaign Management System
- [ ] **Campaign models** with role-based targeting and performance tracking
- [ ] **Campaign admin interface** with preview, analytics, and bulk operations
- [ ] **Campaign scheduling** with frequency and timezone management
- [ ] **Campaign interaction tracking** with impressions, clicks, and conversions
- [ ] **Campaign performance analytics** with ROI and engagement metrics
- [ ] **Role-based targeting** for agents, customers, and user segments

## Implementation Files

### Backend Files to Create
- `app/admin_views.py` - Custom admin dashboard views
- `app/admin_enhancements.py` - Enhanced user and profile admin
- `app/document_admin.py` - Document and service processing admin
- `app/reporting_views.py` - Business intelligence and reporting
- `app/admin_site.py` - Custom admin site configuration
- `app/campaign_admin.py` - Campaign management admin interface
- `templates/admin/dashboard/` - Dashboard HTML templates
- `templates/admin/reports/` - Reporting HTML templates
- `templates/admin/campaign/` - Campaign management templates
- `templates/admin/base_site.html` - Custom admin base template
- `templates/admin/index.html` - Enhanced admin index with widgets
- `static/admin/css/patabima-admin.css` - PataBima admin styling
- `static/admin/js/patabima-admin.js` - Admin JavaScript enhancements
- `static/admin/img/` - PataBima logo and admin images

### Configuration Updates
- `motor_insurance/urls.py` - Add custom admin site URLs
- `motor_insurance/settings.py` - Admin site customization settings
- `app/admin.py` - Register enhanced admin classes with custom site

## Testing Requirements

### Backend Testing
- [ ] Admin dashboard view functionality
- [ ] User management operations
- [ ] Document processing workflows
- [ ] Business intelligence calculations
- [ ] Export functionality
- [ ] Custom admin site navigation
- [ ] Dashboard widgets display
- [ ] Campaign management functionality
- [ ] Campaign targeting and scheduling
- [ ] Campaign performance tracking

### Django Admin Testing
- [ ] Custom admin site loads correctly
- [ ] Dashboard widgets show accurate data
- [ ] Admin navigation works properly
- [ ] Enhanced admin forms function correctly
- [ ] Bulk operations work as expected
- [ ] Campaign creation and management works properly
- [ ] Campaign targeting filters work correctly
- [ ] Campaign analytics display accurate data

## Security Considerations
- Staff-only access to all admin components
- Role-based permissions for different admin functions
- Audit logging for all administrative actions
- Secure API endpoints for dashboard data
- Input validation for all admin forms

## Performance Optimization
- Database query optimization with proper indexing
- Caching for frequently accessed dashboard data
- Pagination for large datasets
- Efficient chart data serialization
- Optimized image and asset loading

## Usage Instructions

### For Developers
1. **Backend Setup**: Create custom admin views and enhanced admin classes
2. **Template Setup**: Implement custom admin templates with PataBima branding
3. **Static Files**: Add PataBima admin CSS and JavaScript files
4. **Admin Site Configuration**: Register custom admin site with enhanced functionality
5. **Testing**: Verify all admin functions work correctly with improved interface

### For Administrators
1. **Enhanced Admin Access**: Use improved Django admin interface with dashboard widgets
2. **Dashboard Overview**: View key metrics directly on admin index page
3. **User Management**: Use enhanced user admin with verification and performance tracking
4. **Analytics Navigation**: Access business intelligence reports through admin navigation
5. **System Monitoring**: Check system health and service status through admin interface
6. **Document Management**: Process and review uploaded documents with enhanced admin tools
7. **Campaign Management**: Create, schedule, and monitor marketing campaigns with role-based targeting
8. **Campaign Analytics**: Track campaign performance, engagement metrics, and ROI analysis

## Next Steps
This enhanced Django admin system enables:
- **Improved administrative interface** with PataBima branding and modern styling
- **Dashboard widgets** integrated directly into Django admin index page
- **Real-time monitoring** of business metrics and system health through web interface
- **Advanced user management** with verification and performance tracking
- **Business intelligence** with detailed analytics and reporting accessible via admin navigation
- **Document processing** with manual review and reprocessing capabilities
- **Enhanced admin experience** with custom navigation and quick actions
- **Professional admin interface** suitable for production deployment

The enhanced admin system provides the foundation for:
- Production deployment with comprehensive admin tools
- Business operations with integrated analytics and monitoring
- User support with detailed customer insights and management tools
- Performance optimization with system health tracking
- Compliance reporting with audit trails and documentation
- Improved administrator workflow with enhanced Django admin interface
```
