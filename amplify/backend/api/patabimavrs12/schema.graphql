# PataBima Insurance App GraphQL Schema
# This schema defines the data models for the insurance sales agent mobile app

type Agent @model @auth(rules: [{allow: owner}]) {
  id: ID!
  agentCode: String! @index(name: "byAgentCode")
  email: String! @index(name: "byEmail")
  firstName: String!
  lastName: String!
  phoneNumber: String!
  profilePicture: String
  totalSales: Float
  totalCommission: Float
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  quotes: [Quote] @hasMany
  clients: [Client] @hasMany
  policies: [Policy] @hasMany
}

type Client @model @auth(rules: [{allow: owner}]) {
  id: ID!
  firstName: String!
  lastName: String!
  email: String
  phoneNumber: String!
  idNumber: String
  dateOfBirth: AWSDate
  address: String
  agentId: ID! @index(name: "byAgent")
  agent: Agent @belongsTo(fields: ["agentId"])
  quotes: [Quote] @hasMany
  policies: [Policy] @hasMany
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Quote @model @auth(rules: [{allow: owner}]) {
  id: ID!
  quoteNumber: String! @index(name: "byQuoteNumber")
  insuranceType: InsuranceType!
  status: QuoteStatus!
  premium: Float!
  coverAmount: Float!
  validUntil: AWSDate!
  clientId: ID! @index(name: "byClient")
  client: Client @belongsTo(fields: ["clientId"])
  agentId: ID! @index(name: "byAgent")
  agent: Agent @belongsTo(fields: ["agentId"])
  motorDetails: MotorDetails
  medicalDetails: MedicalDetails
  wibaDetails: WIBADetails
  travelDetails: TravelDetails
  documents: [String]
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Policy @model @auth(rules: [{allow: owner}]) {
  id: ID!
  policyNumber: String! @index(name: "byPolicyNumber")
  insuranceType: InsuranceType!
  status: PolicyStatus!
  premium: Float!
  coverAmount: Float!
  startDate: AWSDate!
  endDate: AWSDate!
  clientId: ID! @index(name: "byClient")
  client: Client @belongsTo(fields: ["clientId"])
  agentId: ID! @index(name: "byAgent")
  agent: Agent @belongsTo(fields: ["agentId"])
  quoteId: ID
  documents: [String]
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type MotorDetails {
  vehicleType: String!
  make: String!
  model: String!
  year: Int!
  registrationNumber: String!
  engineNumber: String
  chassisNumber: String
  value: Float!
  usage: String!
}

type MedicalDetails {
  age: Int!
  gender: String!
  occupation: String
  preExistingConditions: [String]
  beneficiaries: [String]
}

type WIBADetails {
  occupation: String!
  salary: Float!
  riskCategory: String!
}

type TravelDetails {
  destination: String!
  departureDate: AWSDate!
  returnDate: AWSDate!
  purpose: String!
  age: Int!
}

type AdminPricing @model @auth(rules: [{allow: groups, groups: ["Admin"]}]) {
  id: ID!
  insuranceType: InsuranceType!
  basePremium: Float!
  factors: AWSJSON!
  rates: AWSJSON!
  version: Int!
  isActive: Boolean!
  createdBy: String!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

enum InsuranceType {
  MOTOR
  MEDICAL
  WIBA
  TRAVEL
  PERSONAL_ACCIDENT
}

enum QuoteStatus {
  DRAFT
  SENT
  ACCEPTED
  REJECTED
  EXPIRED
}

enum PolicyStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  PENDING_RENEWAL
}
